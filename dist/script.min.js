function OrderCloudSDKBuyerXP(e){e.decorator("OrderCloudSDK",["$delegate","bachBuyerXp","$q",function(e,t,r){return e.Buyers.Get=function(){var r=e.GetToken();return t.Get(r)},e.Buyers.List=function(){return e.Buyers.Get().then(function(e){return{Items:[e],Meta:{Page:1,PageSize:1,TotalPages:1,TotalCount:1,ItemRange:[1,1]}}})},e.Buyers.Update=function(){var n=[].slice.call(arguments)[1],o=e.GetToken();return n&&n.xp?t.Update(o,n.xp):r.reject("Missing body")},e.Buyers.Patch=function(){var n=[].slice.call(arguments)[1],o=e.GetToken();return n?t.Patch(o,n):r.reject("Missing body")},e}])}function bachBuyerXpService(e,t,r,n){function o(n){function o(){var e=r(function(){c&&(r.cancel(e),a.resolve(c))},100)}var a=e.defer();return c?a.resolve(c):d?o():(d=!0,t.get(u,{headers:{"oc-token":n}}).then(function(e){c={xp:e.data},a.resolve(c)}).catch(function(e){a.reject(e)})),a.promise}function a(e,r){return t.put(u,r,{headers:{"oc-token":e}})}function i(e,r){return t.patch(u,e,{headers:{"oc-token":r}})}var u=n+"/buyerxp",c=null,d=!1,s={Get:o,Update:a,Patch:i};return s}function bachGiftCards(e,t,r,n,o,a){function i(e){return p().create(e).$promise}function u(e){return e.body||e.body.id?p().update({id:e.body.id},e.body).$promise:o.error("id is a required parameter")}function c(e){return p().delete({id:e.id}).$promise}function d(e){return p().list(e&&e.searchTerm?{searchTerm:e.searchTerm}:null).$promise.then(function(e){return e.list})}function s(t){return a.post(e+"/giftcards/purchase/"+t.orderid,{},{headers:{"oc-token":h()}})}function p(){var r={create:{method:"POST"},update:{method:"PUT"},"delete":{method:"DELETE"},list:{method:"GET"}};return _.each(r,function(e){e.headers={"oc-token":h()}}),t(e+"/giftcards/:id",{},r)}function h(){var e=n.Watch().replace(/ /g,"_").toLowerCase(),t=e+".token";return r.get(t)}var l={Create:i,Update:u,Delete:c,List:d,Purchase:s};return l}function bachShipmentsService(e,t,r){function n(e){var t=_.groupBy(e,function(e){var t="",r="";e.ShippingAddress&&(t=(e.ShippingAddress.FirstName+e.ShippingAddress.LastName).replace(/ /g,"").toLowerCase(),r=_.values(_.pick(e.ShippingAddress,"Street1","Street2","City","State","Zip","Country")).join("").replace(/ /g,"").toLowerCase());var n=e.xp.DeliveryDate||"",o=e.xp.DeliveryMethod||"";return t+r+n+o});return o(_.values(t))}function o(e){var t=[];return _.each(e,function(e){var r=_.groupBy(e,function(t){var r=_.filter(e,function(e){return _.some(e.xp,{DeliveryMethod:"InStorePickup"})});return r?t.xp.ProductFromStore:void 0});_.each(r,function(e){t.push(e)})}),a(t)}function a(e){return _.each(e,function(t,r){_.each(t,function(n,o){if(n.Product.xp.isEvent&&t.length>1){var a=t[r].splice(o,1);e.push(a)}})}),e}function i(o,a){var i=n(o),s=[];return _.each(i,function(e,n){var o=[];_.each(e,function(e){o.push({OrderID:a.ID,LineItemID:e.ID,QuantityShipped:e.Quantity})});var i=n+1,p=e[0],h={BuyerID:t,ID:a.ID+"-"+(10>i?"0":"")+i,DateDelivered:null,Cost:e.Cost,Items:o,xp:{Status:u(p),PrintStatus:d(p),Direction:"Outgoing",DeliveryMethod:p.xp.DeliveryMethod,RequestedDeliveryDate:c(p.xp.DeliveryDate),addressType:p.xp.addressType,RecipientName:p.ShippingAddress.FirstName+" "+p.ShippingAddress.LastName,Tax:e.Tax,RouteCode:p.xp.RouteCode,TimePreference:p.xp.deliveryRun||"None",ShipTo:p.ShippingAddress}};s.push(r.Shipments.Create(h))}),e.all(s)}function u(e){return"FTD"===e.xp.DeliveryMethod||"TFE"===e.xp.DeliveryMethod?"OnHold":e.xp.Status&&e.xp.Status.length?e.xp.Status:"New"}function c(e){var t=new Date(e);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+t.getFullYear()}function d(e){return"LocalDelivery"!==e.xp.DeliveryMethod&&"InStorePickup"!==e.xp.DeliveryMethod||"OtherStore"!==e.xp.ProductFromStore?"NotNeeded":"NotPrinted"}var s={Group:n,Create:i};return s}angular.module("bachmans-common",[]),OrderCloudSDKBuyerXP.$inject=["$provide"],angular.module("bachmans-common").config(OrderCloudSDKBuyerXP),bachBuyerXpService.$inject=["$q","$http","$interval","nodeapiurl"],angular.module("bachmans-common").factory("bachBuyerXp",bachBuyerXpService),bachGiftCards.$inject=["nodeapiurl","$resource","$cookies","ocAppName","toastr","$http"],angular.module("bachmans-common").factory("bachGiftCards",bachGiftCards),bachShipmentsService.$inject=["$q","buyerid","OrderCloudSDK"],angular.module("bachmans-common").factory("bachShipments",bachShipmentsService);