function OrderCloudSDKBuyerXP(e){e.decorator("OrderCloudSDK",["$delegate","bachBuyerXp","$q",function(e,t,r){return e.Buyers.Get=function(){var r=e.GetToken();return t.Get(r)},e.Buyers.List=function(){return e.Buyers.Get().then(function(e){return{Items:[e],Meta:{Page:1,PageSize:1,TotalPages:1,TotalCount:1,ItemRange:[1,1]}}})},e.Buyers.Update=function(){var n=[].slice.call(arguments)[1],i=e.GetToken();return n&&n.xp?t.Update(i,n.xp):r.reject("Missing body")},e.Buyers.Patch=function(){var n=[].slice.call(arguments)[1],i=e.GetToken();return n?t.Patch(i,n):r.reject("Missing body")},e}])}function bachBuyerXpService(e,t,r,n){function i(n){function i(){var e=r(function(){c&&(r.cancel(e),a.resolve(c))},100)}var a=e.defer();return c?a.resolve(c):s?i():(s=!0,t.get(o,{headers:{"oc-token":n}}).then(function(e){c={xp:e.data},a.resolve(c)}).catch(function(e){a.reject(e)})),a.promise}function a(e,r){return t.put(o,r,{headers:{"oc-token":e}})}function u(e,r){return t.patch(o,e,{headers:{"oc-token":r}})}var o=n+"/buyerxp",c=null,s=!1,p={Get:i,Update:a,Patch:u};return p}function bachShipmentsService(e,t){function r(e,t,r){return i([e]).then(a).then(u).then(o).then(function(e){c(e,t,r)})}function i(e){var t=function(e){return(e.ShippingAddress.FirstName+e.ShippingAddress.LastName).replace(/ /g,"").toLowerCase()};return s(e,t)}function a(e){var t=function(e){var t=_.values(_.pick(e.ShippingAddress,"Street1","Street2","City","State","Zip","Country")).join("").replace(/ /g,"").toLowerCase();return t};return s(e,t)}function u(e){var t=function(e){return e.xp.DeliveryDate};return s(e,t)}function o(e){var t=function(e){return e.xp.DeliveryMethod};return s(e,t)}function c(e,r,i){_.each(e,function(e,a){var u=[],o=0;_.each(e,function(e){u.push({OrderID:e.OrderID,LineItemID:e.ID,QuantityShipped:e.Quantity}),o=(100*o+100*e.xp.TotalCost)/100});{var c=a+1;({BuyerID:t,ID:r+"-"+(10>c?"0":"")+c,DateDelivered:p(i),Cost:o,Items:u,xp:{Status:"New",addressType:vm.activeOrders[n][0].xp.addressType,RecipientName:vm.activeOrders[n][0].ShippingAddress.FirstName+" "+vm.activeOrders[n][0].ShippingAddress.LastName,Tax:Tax,DeliveryFees:DeliveryFees,CSRID:CurrentUser.ID}})}})}function s(t,r){var n=[];return _.each(t,function(e){var t=_.groupBy(e,function(e){return r(e)});_.each(t,function(e){n.push(e)})}),e.when(n)}function p(e){var t=new Date(e);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+t.getFullYear()}var d={Breakup:r};return d}function bachShipmentsService(e,t,r){function n(e,t){return i(e).then(a).then(u).then(function(e){return o(e,t)})}function i(t){var r=_.groupBy(t,function(e){var t=(e.ShippingAddress.FirstName+e.ShippingAddress.LastName).replace(/ /g,"").toLowerCase(),r=_.values(_.pick(e.ShippingAddress,"Street1","Street2","City","State","Zip","Country")).join("").replace(/ /g,"").toLowerCase(),n=e.xp.DeliveryDate,i=e.xp.DeliveryMethod;return t+r+n+i});return e.when(_.values(r))}function a(t){var r=[];return _.each(t,function(e){var t=_.groupBy(e,function(t){var r=_.filter(e,function(e){return _.some(e.xp,{DeliveryMethod:"InStorePickup"})});return r?t.xp.ProductFromStore:void 0});_.each(t,function(e){r.push(e)})}),e.when(r)}function u(t){return e.when(t)}function o(n,i){var a=[];return _.each(n,function(e,n){var u=[],o=0,d=0;_.each(e,function(e){u.push({OrderID:i.ID,LineItemID:e.ID,QuantityShipped:e.Quantity}),o=(100*o+100*e.LineTotal)/100,d=(100*d+100*e.xp.Tax)/100});var h=n+1,l=e[0],v={BuyerID:t,ID:i.ID+"-"+(10>h?"0":"")+h,DateDelivered:null,Cost:o,Items:u,xp:{Status:c(l),PrintStatus:p(l),Direction:"Outgoing",DeliveryMethod:l.xp.DeliveryMethod,RequestedDeliveryDate:s(l.xp.DeliveryDate),addressType:l.xp.addressType,RecipientName:l.ShippingAddress.FirstName+" "+l.ShippingAddress.LastName,Tax:d,RouteCode:l.xp.RouteCode,TimePreference:l.xp.deliveryRun||"None",ShipTo:l.ShippingAddress}};a.push(r.Shipments.Create(v))}),e.all(a).then(function(e){console.log(e)})}function c(e){return"FTD"===e.xp.DeliveryMethod||"TFE"===e.xp.DeliveryMethod?"OnHold":e.xp.Status&&e.xp.Status.length?e.xp.Status:"New"}function s(e){var t=new Date(e);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+t.getFullYear()}function p(e){return"LocalDelivery"!==e.xp.DeliveryMethod&&"InStorePickup"!==e.xp.DeliveryMethod||"OtherStore"!==e.xp.ProductFromStore?"NotNeeded":"NotPrinted"}var d={Breakup:n};return d}angular.module("bachmans-common",[]),OrderCloudSDKBuyerXP.$inject=["$provide"],angular.module("bachmans-common").config(OrderCloudSDKBuyerXP),bachBuyerXpService.$inject=["$q","$http","$interval","nodeapiurl"],angular.module("bachmans-common").factory("bachBuyerXp",bachBuyerXpService),bachShipmentsService.$inject=["$q","buyerid"],angular.module("orderCloud").factory("bachShipments",bachShipmentsService),bachShipmentsService.$inject=["$q","buyerid","OrderCloudSDK"],angular.module("orderCloud").factory("bachShipments",bachShipmentsService);