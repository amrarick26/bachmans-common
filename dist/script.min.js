function OrderCloudSDKBuyerXP(e){e.decorator("OrderCloudSDK",["$delegate","bachBuyerXp","$q",function(e,t,n){return e.Buyers.Get=function(){var n=e.GetToken();return t.Get(n)},e.Buyers.List=function(){return e.Buyers.Get().then(function(e){return{Items:[e],Meta:{Page:1,PageSize:1,TotalPages:1,TotalCount:1,ItemRange:[1,1]}}})},e.Buyers.Update=function(){var r=[].slice.call(arguments)[1],a=e.GetToken();return r&&r.xp?t.Update(a,r.xp):n.reject("Missing body")},e.Buyers.Patch=function(){var r=[].slice.call(arguments)[1],a=e.GetToken();return r?t.Patch(a,r):n.reject("Missing body")},e}])}function bachAssignments(e,t,n){function r(r){return t(e+"/assignments/usergroup",{},{call:{method:"POST",headers:{"oc-token":n.GetToken()}}}).call(r).$promise}var a={UserGroup:r};return a}function bachBuyerXpService(e,t,n,r){function a(r){function a(){var e=n(function(){c&&(n.cancel(e),o.resolve(c))},100)}var o=e.defer();return c?o.resolve(c):s?a():(s=!0,t.get(u,{headers:{"oc-token":r}}).then(function(e){c={xp:e.data},o.resolve(c)}).catch(function(e){o.reject(e)})),o.promise}function o(e,n){return t.put(u,n,{headers:{"oc-token":e}})}function i(e,n){return t.patch(u,e,{headers:{"oc-token":n}})}var u=r+"/buyerxp",c=null,s=!1,d={Get:a,Update:o,Patch:i};return d}function bachGiftCards(e,t,n,r,a){function o(e){return d().create(e).$promise}function i(e){return e.body||e.body.id?d().update({id:e.body.id},e.body).$promise:n.error("id is a required parameter")}function u(e){return d().delete({id:e.id}).$promise}function c(e){return d().list(e&&e.searchTerm?{searchTerm:e.searchTerm}:null).$promise.then(function(e){return e.list})}function s(t){return r.post(e+"/giftcards/purchase/"+t.orderid,{},{headers:{"oc-token":a.GetToken()}})}function d(){var n={create:{method:"POST"},update:{method:"PUT"},"delete":{method:"DELETE"},list:{method:"GET"}};return _.each(n,function(e){e.headers={"oc-token":a.GetToken()}}),t(e+"/giftcards/:id",{},n)}var p={Create:o,Update:i,Delete:u,List:c,Purchase:s};return p}function bachShipmentsService(e,t,n){function r(e){var t=_.groupBy(e,function(e){var t="",n="";e.ShippingAddress&&(t=(e.ShippingAddress.FirstName+e.ShippingAddress.LastName).replace(/ /g,"").toLowerCase(),n=_.values(_.pick(e.ShippingAddress,"Street1","Street2","City","State","Zip","Country")).join("").replace(/ /g,"").toLowerCase());var r=e.xp.DeliveryDate||"",a=e.xp.DeliveryMethod||"";e.xp.Status&&e.xp.Status.indexOf("FTD")>-1&&(e.xp.Status="FTD"),e.xp.Status&&e.xp.Status.indexOf("TFE")>-1&&(e.xp.Status="TFE");var o=e.xp.Status||"Open";return t+n+r+a+o});return a(_.values(t))}function a(e){var t=[];return _.each(e,function(e){var n=_.filter(e,function(e){return _.some(e.xp,{DeliveryMethod:"InStorePickup"})}),r=_.groupBy(e,function(e){return n?e.xp.ProductFromStore:void 0});_.each(r,function(e){t.push(e)})}),o(t)}function o(e){return _.each(e,function(t,n){_.each(t,function(r,a){if(r.Product.xp.isEvent&&t.length>1){var o=t[n].splice(a,1);e.push(o)}})}),i(e)}function i(e){return _.each(e,function(e){e.Cost=0,e.Tax=0,_.each(e,function(t){t&&t.xp&&(t.xp.Tax=t.xp.Tax||0,e.Cost=(100*e.Cost+100*t.LineTotal)/100,e.Tax=(100*e.Tax+100*t.xp.Tax)/100)}),e.Total=(100*e.Cost+e.Tax)/100}),e}function u(a,o,i){var u=r(a),p=[];return _.each(u,function(r,a){var u=[];_.each(r,function(e){u.push({OrderID:o.ID,LineItemID:e.ID,QuantityShipped:e.Quantity})});var h=a+1,l=r[0],m={BuyerID:t,ID:o.ID+"-"+(10>h?"0":"")+h,DateDelivered:null,Cost:r.Cost,Items:u,xp:{Status:c(l),PrintStatus:d(l),Direction:"Outgoing",DeliveryMethod:l.xp.DeliveryMethod,RequestedDeliveryDate:s(l.xp.DeliveryDate),addressType:l.xp.addressType,RecipientName:l.ShippingAddress.FirstName+" "+l.ShippingAddress.LastName,Tax:r.Tax,RouteCode:l.xp.RouteCode,TimePreference:l.xp.deliveryRun||"NO PREF",ShipTo:l.ShippingAddress}};i?p.push(function(){return n.AsAdmin().Shipments.Create(m).then(function(t){var r=[];return _.each(m.Items,function(e){t.Items=[],t.Items.push(e),r.push(n.AsAdmin().Shipments.SaveItem(t.ID,e))}),e.all(r).then(function(){return t})})}()):p.push(n.Shipments.Create(m))}),e.all(p)}function c(e){return e.xp.DeliveryMethod&&(e.xp.DeliveryMethod.indexOf("FTD")>-1||e.xp.DeliveryMethod.indexOf("TFE")>-1)?"OnHold":e.xp.Status&&"OnHold"===e.xp.Status?"OnHold":e.xp.addressType&&["Funeral","Church","Cemetary"].indexOf(e.xp.addressType)>-1?"OnHold":"New"}function s(e){var t=new Date(e);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+t.getFullYear()}function d(e){return"LocalDelivery"===e.xp.DeliveryMethod||"InStorePickup"===e.xp.DeliveryMethod&&"OtherStore"===e.xp.ProductFromStore?"NotPrinted":"NotNeeded"}function p(t){var r={},a={pageSize:100,orderID:t};return n.Shipments.List(a).then(function(t){var a=[];return _.each(t.Items,function(e){a.push(function(){return n.Shipments.ListItems(e.ID).then(function(t){return e.Items=t.Items,_.each(t.Items,function(e){r[e.LineItemID]=e}),e})}())}),e.all(a).then(function(e){return _.each(e,function(t,n){_.each(t.Items,function(t,a){_.each(t.xp.AddExtraLineItemsList,function(t,o){e[n].Items[a].xp.AddExtraLineItemsList[o]=r[t]})})}),e})})}var h={Group:r,Create:u,List:p};return h}angular.module("bachmans-common",[]),OrderCloudSDKBuyerXP.$inject=["$provide"],angular.module("bachmans-common").config(OrderCloudSDKBuyerXP),bachAssignments.$inject=["nodeapiurl","$resource","OrderCloudSDK"],angular.module("bachmans-common").factory("bachAssignments",bachAssignments),bachBuyerXpService.$inject=["$q","$http","$interval","nodeapiurl"],angular.module("bachmans-common").factory("bachBuyerXp",bachBuyerXpService),bachGiftCards.$inject=["nodeapiurl","$resource","toastr","$http","OrderCloudSDK"],angular.module("bachmans-common").factory("bachGiftCards",bachGiftCards),bachShipmentsService.$inject=["$q","buyerid","OrderCloudSDK"],angular.module("bachmans-common").factory("bachShipments",bachShipmentsService);